<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>What happens when ...? | 沈新新的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="按下”g”键 相关知识点：物理键盘和系统中断的工作原理  按下一颗键后，系统怎么知道你按的是哪颗？  产生码值     我们选择键盘上的回车键被按到最低处作为起点。在这个时刻，一个专用于回车键的电流回路被直接地或者通过电容器间接地闭合了，使得少量的电流进入了键盘的逻辑电路系统。这个系统会扫描每个键的状态，对于按键开关的电位弹跳变化进行噪音消除(debounce)，并将其转化为键盘码值。在这里，回车">
<meta name="keywords" content="tech,basic">
<meta property="og:type" content="article">
<meta property="og:title" content="What happens when ...?">
<meta property="og:url" content="http://yoursite.com/2018/02/21/what-2/index.html">
<meta property="og:site_name" content="沈新新的博客">
<meta property="og:description" content="按下”g”键 相关知识点：物理键盘和系统中断的工作原理  按下一颗键后，系统怎么知道你按的是哪颗？  产生码值     我们选择键盘上的回车键被按到最低处作为起点。在这个时刻，一个专用于回车键的电流回路被直接地或者通过电容器间接地闭合了，使得少量的电流进入了键盘的逻辑电路系统。这个系统会扫描每个键的状态，对于按键开关的电位弹跳变化进行噪音消除(debounce)，并将其转化为键盘码值。在这里，回车">
<meta property="og:image" content="http://yoursite.com/2018/02/21/what-2/media/15011257367118/15011271175884.jpg">
<meta property="og:image" content="http://yoursite.com/2018/02/21/what-2/media/15011257367118/15011271911500.jpg">
<meta property="og:image" content="http://yoursite.com/2018/02/21/what-2/media/15011257367118/15012107324446.jpg">
<meta property="og:image" content="http://yoursite.com/2018/02/21/what-2/bg2014020502.png">
<meta property="og:updated_time" content="2018-02-20T17:32:21.520Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="What happens when ...?">
<meta name="twitter:description" content="按下”g”键 相关知识点：物理键盘和系统中断的工作原理  按下一颗键后，系统怎么知道你按的是哪颗？  产生码值     我们选择键盘上的回车键被按到最低处作为起点。在这个时刻，一个专用于回车键的电流回路被直接地或者通过电容器间接地闭合了，使得少量的电流进入了键盘的逻辑电路系统。这个系统会扫描每个键的状态，对于按键开关的电位弹跳变化进行噪音消除(debounce)，并将其转化为键盘码值。在这里，回车">
<meta name="twitter:image" content="http://yoursite.com/2018/02/21/what-2/media/15011257367118/15011271175884.jpg">
  
    <link rel="alternate" href="../../../../atom.xml" title="沈新新的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="../../../../css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../../../index.html" id="logo">沈新新的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="../../../../index.html">Home</a>
        
          <a class="main-nav-link" href="../../../../archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="../../../../atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-what-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2018-02-20T17:23:36.000Z" itemprop="datePublished">2018-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      What happens when ...?
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="按下”g”键"><a href="#按下”g”键" class="headerlink" title="按下”g”键"></a>按下”g”键</h2><blockquote>
<p>相关知识点：物理键盘和系统中断的工作原理</p>
</blockquote>
<h6 id="按下一颗键后，系统怎么知道你按的是哪颗？"><a href="#按下一颗键后，系统怎么知道你按的是哪颗？" class="headerlink" title="按下一颗键后，系统怎么知道你按的是哪颗？"></a>按下一颗键后，系统怎么知道你按的是哪颗？</h6><ul>
<li><ol>
<li>产生码值</li>
</ol>
</li>
</ul>
<blockquote>
<p>我们选择键盘上的回车键被按到最低处作为起点。在这个时刻，一个专用于回车键的电流回路被直接地或者通过电容器间接地闭合了，使得少量的电流进入了键盘的逻辑电路系统。这个系统会扫描每个键的状态，对于按键开关的电位弹跳变化进行噪音消除(debounce)，并将其转化为键盘码值。在这里，回车的码值是13。键盘控制器在得到码值之后，将其编码，用于之后的传输。</p>
</blockquote>
<ul>
<li><ol>
<li>传输到操作系统</li>
</ol>
</li>
</ul>
<blockquote>
<p>现在这个传输过程几乎都是通过通用串行总线(USB)或者蓝牙(Bluetooth)来进行的。这个串行信号在计算机的USB控制器处被解码，然后被人机交互设备通用键盘驱动进行进一步解释。之后按键的码值被传输到操作系统的硬件抽象层。</p>
</blockquote>
<ul>
<li><ol>
<li>消息发往应用程序</li>
</ol>
</li>
</ul>
<blockquote>
<p>操作系统讲信号进行翻译成键码值，传给当前活跃的窗口／应用程序。</p>
</blockquote>
<h6 id="浏览器地址栏怎么处理你输入的那个值？"><a href="#浏览器地址栏怎么处理你输入的那个值？" class="headerlink" title="浏览器地址栏怎么处理你输入的那个值？"></a>浏览器地址栏怎么处理你输入的那个值？</h6><blockquote>
<p>当你按下“g”键，浏览器接收到这个消息之后，会触发自动完成机制。浏览器根据自己的算法，以及你是否处于隐私浏览模式，会在浏览器的地址框下方给出输入建议。大部分算法会优先考虑根据你的搜索历史和书签等内容给出建议。</p>
</blockquote>
<p><img src="media/15011257367118/15011271175884.jpg" alt=""></p>
<h2 id="解析URL"><a href="#解析URL" class="headerlink" title="解析URL"></a>解析URL</h2><p>用户按下回车之后，浏览器开始解析URL的工作。</p>
<ul>
<li><ol>
<li>判断URL是否合法？</li>
</ol>
</li>
</ul>
<blockquote>
<p>当协议或主机名不合法时，浏览器会将地址栏中输入的文字传给默认的搜索引擎。大部分情况下，在把文字传递给搜索引擎的时候，URL会带有特定的一串字符，用来告诉搜索引擎这次搜索来自这个特定浏览器。<br><img src="media/15011257367118/15011271911500.jpg" alt=""></p>
</blockquote>
<ul>
<li><ol>
<li>检查 HSTS 列表</li>
</ol>
</li>
</ul>
<blockquote>
<p>浏览器检查自带的“预加载 HSTS（HTTP严格传输安全）”列表，这个列表里包含了那些请求浏览器只使用HTTPS进行连接的网站。如果网站在这个列表里，浏览器会使用 HTTPS 而不是 HTTP 协议，否则，最初的请求会使用HTTP协议发送</p>
</blockquote>
<h2 id="DNS-查询"><a href="#DNS-查询" class="headerlink" title="DNS 查询"></a>DNS 查询</h2><blockquote>
<p>查询顺序：浏览器缓存-本地hosts-DNS服务器</p>
</blockquote>
<ul>
<li>1.浏览器缓存<br>  要查看 Chrome 当中的缓存， 打开 chrome://net-internals/#dns</li>
<li>2.本地hosts<br>  调用 gethostbyname 库函数（操作系统不同函数也不同）进行查询</li>
<li>3.DNS服务器<br>  如果 DNS 服务器和我们的主机在同一个子网内，系统会按照下面的 ARP 过程对 DNS 服务器进行 ARP查询。<br>如果 DNS 服务器和我们的主机在不同的子网，系统会按照下面的 <strong>ARP 过程</strong>对默认网关进行查询</li>
</ul>
<h2 id="ARP过程"><a href="#ARP过程" class="headerlink" title="ARP过程"></a>ARP过程</h2><p>ARP(Address Resolution Protocol)地址解析协议</p>
<p>需要：<br>目标IP地址 、<br>用于发送 ARP 广播的接口的 MAC 地址</p>
<ol>
<li>首先查询 ARP 缓存，如果缓存命中，我们返回结果：目标 IP = MAC</li>
<li>查看路由表，看看目标 IP 地址是不是在本地路由表中的某个子网内。是的话，使用跟那个子网相连的接口，否则使用与默认网关相连的接口。查询选择的网络接口的 MAC 地址</li>
<li>我们发送一个二层（ OSI 模型 中的数据链路层）ARP 请求</li>
</ol>
<p>##TCP连接<br>现在我们已经知道google.com的IP地址了，接下来浏览器会调用系统库函数 socket ，请求一个 TCP流套接字。</p>
<ol>
<li>这个请求首先被交给传输层，在传输层请求被封装成 TCP segment</li>
<li>TCP segment 被送往网络层，网络层会在其中再加入一个 IP 头部，把它封装成一个TCP packet</li>
<li>这个 TCP packet 接下来会进入链路层，链路层会在封包中加入 frame头 部，里面包含了本地内置网卡的MAC地址以及网关（本地路由器）的 MAC 地址。</li>
</ol>
<p><em>TCP封包is ready</em></p>
<h6 id="建立TCP连接："><a href="#建立TCP连接：" class="headerlink" title="建立TCP连接："></a>建立TCP连接：</h6><p>TCP连接的整个过程，用一张图来描述一下（图片来源：网络）<br><img src="media/15011257367118/15012107324446.jpg" alt=""><br>首先Client端发送连接请求报文，Server段接受连接后回复ACK报文，并为这次连接分配资源。Client端接收到ACK报文后也向Server段发送报文，并分配资源，这样TCP连接就建立了</p>
<h2 id="SSL／TSL协议的握手过程"><a href="#SSL／TSL协议的握手过程" class="headerlink" title="SSL／TSL协议的握手过程"></a>SSL／TSL协议的握手过程</h2><pre><code>使用SSL/TLS的HTTP通信，就是传说中的HTTPS。
用户访问HTTPS头的地址，就需要进行SSL／TSL握手过程。
</code></pre><blockquote>
<p>原理：SSL/TLS协议的基本思路是采用公钥加密法，也就是说，客户端先向服务器端索要公钥，然后用公钥加密信息，服务器收到密文后，用自己的私钥解密。<br>bg2014020502.png<br><img src="/2018/02/21/what-2/bg2014020502.png" title="图片来源：阮一峰的网络日志"></p>
</blockquote>
<p>更多信息参考：<a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</a> </p>
<h2 id="服务器端处理请求"><a href="#服务器端处理请求" class="headerlink" title="服务器端处理请求"></a>服务器端处理请求</h2><p>现在，我们已经建立客户端和服务器端的连接了。服务器是怎么处理我们发过去的请求的呢？</p>
<ol>
<li>服务器端收到请求后，会把请求拆分为几个参数：<strong>HTTP 请求方法、域名、请求路径</strong>。</li>
<li>服务器验证其上已经配置了 google.com 的虚拟主机</li>
<li>服务器验证 google.com 接受 GET 方法</li>
<li>服务器验证该用户可以使用 GET 方法(根据 IP 地址，身份信息等)</li>
<li>服务器根据请求信息获取相应的响应内容</li>
<li>服务器会使用指定的处理程序分析处理这个文件</li>
</ol>
<h2 id="客户端收到服务端返回的资源"><a href="#客户端收到服务端返回的资源" class="headerlink" title="客户端收到服务端返回的资源"></a>客户端收到服务端返回的资源</h2><h6 id="网页资源被解释成DOM树"><a href="#网页资源被解释成DOM树" class="headerlink" title="网页资源被解释成DOM树"></a>网页资源被解释成DOM树</h6><ol>
<li>网页被交给HTML解释器转变成一系列的Token</li>
<li>解释器根据Token构建Node，形成DOM树</li>
<li>如果节点是JS代码的话，调用JavaScript引擎解释并执行。</li>
<li>如果节点需要依赖其他资源，如图片、CSS、视频等，调用资源加载器来加载他们。</li>
</ol>
<h6 id="CSS文件被解释成CSSOM树"><a href="#CSS文件被解释成CSSOM树" class="headerlink" title="CSS文件被解释成CSSOM树"></a>CSS文件被解释成CSSOM树</h6><ol>
<li>CSS文件被CSS解释器解释成内部表示结构。</li>
<li>CSS解释器工作完之后，在DOM树上附加解释后的样式信息，即RenderObject树。</li>
<li>RenderObject节点在创建的同时，WebKit会根据网页的层次结构创建RenderLayer树，同时构建一个虚拟的绘图上下文。</li>
</ol>
<h6 id="根据绘图上下文来生成最终的图像"><a href="#根据绘图上下文来生成最终的图像" class="headerlink" title="根据绘图上下文来生成最终的图像"></a>根据绘图上下文来生成最终的图像</h6><p>这一过程主要依赖2D和3D图形库</p>
<ol>
<li>绘图上下文将每个绘图操作桥接到不同的绘图具体实现类</li>
<li>绘图实现类将2D图形库或3D图形库绘制的结果保存下来，交给浏览器进行显示。</li>
</ol>
<p>绘图有软件渲染、GPU硬件渲染、混合渲染模型等方式。</p>
<p>由于网页的动画或者用户的交互，浏览器其实一直在不停地重复执行渲染过程。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/21/what-2/" data-id="cjdvxdoah0001h79lgt84jnn9" class="article-share-link">Teilen</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/basic/">basic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/tech/">tech</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="../../12/tomato/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">tomato</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/other/">other</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Efficiency/">Efficiency</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/basic/">basic</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/tech/">tech</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../../../../tags/Efficiency/" style="font-size: 10px;">Efficiency</a> <a href="../../../../tags/basic/" style="font-size: 10px;">basic</a> <a href="../../../../tags/tech/" style="font-size: 10px;">tech</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2018/02/">February 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="">What happens when ...?</a>
          </li>
        
          <li>
            <a href="../../12/tomato/">tomato</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 沈新新<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/script.js"></script>



  </div>
</body>
</html>